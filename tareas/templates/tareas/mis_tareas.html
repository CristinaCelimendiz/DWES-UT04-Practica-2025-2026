<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Mis tareas</title>
</head>
<body>
  <h1>Mis tareas</h1>

  <p><a href="{% url 'tareas:crear_tarea_individual' %}">+ Crear tarea individual</a></p>
  <p><a href="{% url 'tareas:crear_tarea_grupal' %}">+ Crear tarea grupal</a></p>

  <p><a href="{% url 'tareas:lista_usuarios' %}">Ir a Listado de usuarios</a></p>
  <p><a href="{% url 'tareas:mis_datos' %}">Mis datos</a></p>

  {% if user.role == "PROFESOR" %}
    <p>
      <a href="{% url 'tareas:tareas_pendientes_validacion' %}">
        Ir a validaciones pendientes ({{ pendientes_validacion }})
      </a>
    </p>
  {% endif %}

  <h2>Tareas creadas por mí</h2>
  <ul>
    {% for t in tareas_creadas %}
      <li>
        <strong>{{ t.titulo }}</strong>
        {% if t.validada %}
          (validada)
        {% elif t.completada and t.requiere_validacion_profesor %}
          (completada, pendiente de validación)
        {% elif t.completada %}
          (completada)
        {% else %}
          (pendiente)
        {% endif %}

        {% if t.validada and t.validada_por %}
          <small> — validada por {{ t.validada_por.username }}</small>
        {% endif %}

        {% if user.role == "ALUMNO" and not t.completada and not t.validada %}
          <form method="post" action="{% url 'tareas:completar_tarea' t.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit">Marcar completada</button>
          </form>
        {% endif %}

        {% if t.tareagrupal %}
          <br>
          <small>
            <strong>Colaboradores:</strong>
            {% for c in t.tareagrupal.colaboradores.all %}
              {{ c.username }}{% if not forloop.last %}, {% endif %}
            {% empty %}
              ninguno
            {% endfor %}
          </small>
        {% endif %}
      </li>
    {% empty %}
      <li>No has creado tareas.</li>
    {% endfor %}
  </ul>

  <h2>Tareas grupales donde colaboro</h2>
  <ul>
    {% for t in tareas_colaboro %}
      <li>
        <strong>{{ t.titulo }}</strong>
        {% if t.validada %}
          (validada)
        {% elif t.completada and t.requiere_validacion_profesor %}
          (completada, pendiente de validación)
        {% elif t.completada %}
          (completada)
        {% else %}
          (pendiente)
        {% endif %}

        {% if t.validada and t.validada_por %}
          <small> — validada por {{ t.validada_por.username }}</small>
        {% endif %}

        {% if user.role == "ALUMNO" and not t.completada and not t.validada %}
          <form method="post" action="{% url 'tareas:completar_tarea' t.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit">Marcar completada</button>
          </form>
        {% endif %}

        <br>
        <small>
          <strong>Creador:</strong> {{ t.creada_por.username }} |
          <strong>Colaboradores:</strong>
          {% for c in t.colaboradores.all %}
            {{ c.username }}{% if not forloop.last %}, {% endif %}
          {% empty %}
            ninguno
          {% endfor %}
        </small>
      </li>
    {% empty %}
      <li>No colaboras en tareas grupales.</li>
    {% endfor %}
  </ul>

</body>
</html>
